<!DOCTYPE html>
<html ng-app="app">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Mandiri Tunas Finance</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.5 -->
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="font-awesome/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="ionicons/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
	<link rel="stylesheet" href="plugins/select2/select2.min.css">
	
	<link rel="stylesheet" href="plugins/datatables/dataTables.bootstrap.css">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	
	<link href="dist/site.css" rel="stylesheet" />
	<link href="plugins/jQueryUItotop/ui.totop.css" rel="stylesheet" />
	<link rel="stylesheet" href="plugins/JQueryValidation/validationEngine.jquery.css">
	<link href="chatjs/css/jquery.chatjs.css" rel="stylesheet" /> 
	<link href="plugins/datepicker/datepicker3.css" rel="stylesheet" />
	<link rel="stylesheet" href="bootstrap/css/bootstrap-tagsinput.css">
	<link rel="stylesheet" href="dist/app.css">	
	<link rel='stylesheet' href='plugins/fullcalendar/fullcalendar.min.css' />
	<link rel='stylesheet' href='plugins/datatables/extensions/Responsive/css/dataTables.responsive.css' />
	
		<style type="text/css">
		table>tbody>td{
			border: 1px solid #bebebe !important
		
		}
		form.jp-navbar-form {
			padding-top:3px;
			padding-left:50px;
			margin:0;
		}
		.clear-margin{
			margin:0 !important;
			padding-top:3px;
			padding-left:250px;
		}
	

    /* Custom Styles */
    ul.nav-tabs{
        width: 200px;
        margin-top: 20px;
        border-radius: 4px;
        border: 1px solid #ddd;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.067);
    }
    ul.nav-tabs li{
        margin: 0;
        border-top: 1px solid #ddd;
    }
    ul.nav-tabs li:first-child{
        border-top: none;
    }
    ul.nav-tabs li a{
        margin: 0;
        padding: 8px 16px;
        border-radius: 0;
    }
    ul.nav-tabs li.active a, ul.nav-tabs li.active a:hover{
        color: #fff;
        background: #0088cc;
        border: 1px solid #0088cc;
    }
    ul.nav-tabs li:first-child a{
        border-radius: 4px 4px 0 0;
    }
    ul.nav-tabs li:last-child a{
        border-radius: 0 0 4px 4px;
    }
    ul.nav-tabs.affix{
        top: 30px; /* Set the top position of pinned element */
    }
	#example1 thead tr th{
		text-align:center;
	}
	#example1 tbody tr td,#example1  thead tr th{
		border: 1px solid black;
	}
</style>
  </head>
 <body class="hold-transition skin-blue sidebar-collapse sidebar-mini fixed"  data-spy="scroll" data-target="#myScrollspy">
    <div class="wrapper">

      
     <div id="header">
        <header class="main-header">
        <!-- Logo -->
        <a  class="logo">
            <!-- mini logo for sidebar mini 50x50 pixels -->
        <span class="logo-mini" style="line-height:60px;"><img src="dist/img/mtf-bg-biru.png" width="50px" /></span> 
            <!-- logo for regular state and mobile devices -->
        <span class="logo-lg"><img src="dist/img/mtf-bg-biru.png" width="100px" /></span> 
        </a>
        <!-- Header Navbar: style can be found in header.less -->
        <nav class="navbar navbar-static-top" role="navigation">
            <!-- Sidebar toggle button-->
            <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
            <span class="sr-only">Toggle navigation</span>
            </a>
	        <div class="navbar-custom-menu pull-left"> 
	        <ul class="nav navbar-nav">
		       <li>	<a id="judul-page" href="#">RKS </a></li> 
	        </ul>
	        </div>
            <div class="navbar-custom-menu">            
            <ul id="menu-top" class="nav navbar-nav">
                <li><a href="#" id="cetak-rks" title="Cetak"><i class="fa fa-fw fa-print " style="font-size:20px;"></i>Cetak</a></li>
               <li><a href="#" id="simpan" attr2="save" title="Simpan" style="display:none" ><i class="fa fa-fw fa-save " style="font-size:20px;"></i>Simpan</a></li>
            </ul>
            </div>
        </nav>
        </header>
    </div>
          <!-- Left side column. contains the logo and sidebar -->
    <div id="menu"  >
          <aside class="main-sidebar" >
            <!-- sidebar: style can be found in sidebar.less -->
             <section class="sidebar" >
              <!-- sidebar menu: : style can be found in sidebar.less -->
              <ul class="sidebar-menu"  ng-controller="side-menu">
               <!-- <li class="header">MAIN NAVIGATION</li>-->
             
			    <li class="treeview" ng-repeat="menu in menus">
				    <a href="{{menu.url}}">
				        <i class="{{menu.css}}"></i> <span ng-bind="menu.menu"></span>
				    </a>				
			    </li>
              </ul>
            </section>
            <!-- /.sidebar -->
          </aside>
     </div>
    
      <!-- Content Wrapper. Contains page content -->
      <div class="content-wrapper">
    
		 <section class="content">

			<!-- Default box -->
			<input type="hidden" id="pengadaanId" />
             <input type="hidden" id="region" />
             <input type="hidden" id="aturan-pengadaan" />
			 <div id="page-content" class="box box-primary box-white" >
				<div class="box-body ">	
					<div class="row">
						<div class="col-md-10">
							<div id="notif">
							</div>
						</div>
					</div>	
					<div class="col-md-10">
                        <form role="form" class="jp-form">
                            <div class="row">
                                <div class="form-group">
                                    <div class="form-group judul-pengadaan">
                                        <label id="judul"></label>
                                    </div>
                                    <div class="form-group">
                                        <label id="deskripsi"> </label>
                                    </div>
                                    <div class="form-group">
                                        <label id="keterangan"></label>
                                    </div>
                                    <!--<div class="form-group">
                    <label id="Status"></label>
                </div>-->
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-md-6">
                                    <label style="display:block"><b>Total HPS : </b></label>
                                    <label style="display:block" id="totalRKS">0</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="padtop  button-row">
                                            <a alt="tambah judul" class="add btn btn-primary add-judul" attr="0" data-toggle="tooltip" title="Tambah Judul"><span class="fa fa-plus"></span> Add Judul</a>
                                            <a class="add btn btn-primary load-rks" data-toggle="tooltip" title="Load From Repository HPS">Load From HPS Repository </a>
                                            <a class="add btn btn-primary save-template-hps" data-toggle="tooltip" title="Save To Repository HPS">Save To HPS Repository </a>
                                            <!--<a id="take" class="btn btn-xs btn-primary" ><span class="fa  fa-edit"></span></a>-->
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <input type="hidden" id="idRks" />
                                        <table id="example1" class="table table-bordered table-hover" width="100%">
                                            <thead>
                                                <tr>
                                                    <th class="tengah">Nama</th>
                                                    <th class="tengah">Item</th>
                                                    <th class="tengah">Satuan</th>
                                                    <th class="tengah">Jumlah</th>
                                                    <th class="tengah">HPS Satuan</th>
                                                    <th class="tengah">Total</th>
                                                    <th class="tengah">Keterangan</th>
                                                    <th class="tengah">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>


                                        <!--<table style="display:none" id="example2" class="table table-bordered  editabletable" width="100%">
                                            <thead>
                                                <tr>
                                                    <th>Item</th>
                                                    <th>Satuan</th>
                                                    <th>Jumlah</th>
                                                    <th>HPS Satuan</th>
                                                    <th>Total</th>
                                                    <th>Keterangan</th>
                                                    <th>action</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>-->
                                    </div>
                                </div>
                            </div>
                        </form>							
					</div>	
				</div>
			</div>
			
			
		</section><!-- /.content -->
		</div>
	
       
	   <footer class="main-footer">
       <!-- <div class="pull-right hidden-xs">
          <b>Version</b> 1.0.0
        </div>
        <strong>Pengadaan-e</strong> -->
	    </footer>
    </div><!-- ./wrapper -->
	
	
    <!--kilk persetujuan-->
         <!-- Modal -->
    <div class="modal" id="modal-simpan" role="dialog" aria-hidden="true">
      <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
		    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		    <h4 class="modal-title">Konfirmasi</h4>
              <div class="modal-body" id="konten-simpan">              
               </div>
	      </div>
	      <div class="modal-footer">
              <button type="button" id="kembali" class="btn btn-default" data-toggle="tooltip" title="Kembali Ke Halaman Sebelumnya" >Kembali</button>		
            <!--<button type="button" class="btn btn-default" data-dismiss="modal" data-toggle="tooltip" title="Lanjutkan isi RKS">Lanjutkan</button>-->		
               <button type="button" class="btn btn-default refresh"  data-toggle="tooltip" title="Lanjutkan isi RKS">Lanjutkan</button>		
	      </div>
	    </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

     <!--kilk persetujuan-->
         <!-- Modal -->
    <div class="modal" id="modal-load-rks" role="dialog" aria-hidden="true">
      <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
		    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		    <h4 class="modal-title">Form Load RKS</h4>
              <div class="modal-body"> 
                  <div class="row">
                        <div class="col-md-12">
                            <form class="form-horizontal label-kanan">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">Judul</label>
                                    <div class="col-sm-4">
                                        <input id="title-rks" type="text" class="form-control " placeholder="Judul">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">Klasifikasi</label>
                                    <div class="col-sm-4">
                                        <select id="klasifikasi-rks" class="form-control select2" style="width: 100%;">
                                            <option selected="selected" value="">ALL</option>
                                            <option value="0">SIPIL</option>
                                            <option value="1">NONSIPIL</option>
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                  <div class="row">
                    <div class="col-md-12">
                        <table id="list-rks-template" class="table table-bordered">
                            <thead>
                                <tr>
                                    <th class="tengah">Title</th>
                                    <th class="tengah">Deskripsi</th>
                                    <th class="tengah">Klasifikasi</th>
                                    <th class="tengah">Action</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
               </div>
	      </div>
	      <div class="modal-footer">
             <!-- <button type="button" class="btn btn-default load-get-rks" data-toggle="tooltip" title="Load RKS" >Load</button>		
            -->
              <button type="button" class="btn btn-default" data-dismiss="modal" data-toggle="tooltip" title="Keluar">Close</button>
	      </div>
	    </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- jQuery 2.1.4 -->
    <script src="plugins/jQuery/jQuery-2.1.4.min.js"></script>
     <script src="site.js"></script>
    <!-- Bootstrap 3.3.5 -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <!-- SlimScroll -->
    <script src="plugins/slimScroll/jquery.slimscroll.min.js"></script>
    <!-- FastClick -->
    <script src="plugins/fastclick/fastclick.min.js"></script>
  
	<script src="plugins/datatables/jquery.dataTables.min.js"></script>
	<script src="plugins/datatables/dataTables.bootstrap.min.js"></script>
	<script src="plugins/jQueryUItotop/easing.js"></script>
	<script src="plugins/jQueryUItotop/jquery.ui.totop.js"></script>
	<script src="plugins/JQueryValidation/jquery.validate.js"></script>
	<script src="plugins/datepicker/bootstrap-datepicker.js"></script>
	<script src="plugins/jQueryUI/jquery-ui-autocomplete.js"></script>
	<script src="plugins/accounting/accounting.js"></script>	
     <script src="plugins/bootstrap-dialog/bootstrap-dialog.min.js"></script>
	<script src="dist/site.js"></script>	
	 <script src='plugins/fullcalendar/moment.min.js'></script>
    <script src='plugins/fullcalendar/fullcalendar.min.js'></script>
    <script src='plugins/fullcalendar/lang/id.js'></script>
	<script src="plugins/typeaheadjs/typeahead.bundle.min.js"></script>
	<script src="plugins/typeaheadjs/handlebars.js"></script>
	<script src="plugins/typeaheadjs/bootstrap-tagsinput.js"></script>
	 <script  src='plugins/datatables/extensions/Responsive/js/dataTables.responsive.min.js' ></script>
     <script src='plugins/PriceFormat/jquery.priceformat.js'></script>

     <script src="dist/js/app.min.js"></script>
    <!--<script src="chatjs/chat.js"></script>-->
    <script src="plugins/angular/angular.min.js"></script>
    <!-- <script src="plugins/typeaheadjs/typeahead.bundle.min.js"></script>
	<script src="plugins/typeaheadjs/handlebars.js"></script>
	<script src="plugins/typeaheadjs/bootstrap-tagsinput.js"></script>
	 <script src="plugins/typeaheadjs/app_bs3.js"></script>-->
     <script src="plugins/htmltoword/FileSaver.js"></script> 
    <script src="plugins/htmltoword/jquery.wordexport.js"></script>
     <script src="dist/js/rks.js"></script>	
     <script src="dist/js/menu.js"></script>	
     <script>
         var listTableRks;
         $(function () {
             listTableRks = $('#list-rks-template').DataTable({
                 "serverSide": true,
                 "searching": false,
                 "ajax": {
                     "url": '../Api/Rks/List',
                     "type": 'POST',
                     "data": function (d) {
                         d.search = $("#title-rks").val();
                         d.klasifikasi = $("#klasifikasi-rks option:selected").val();
                     }

                 },
                 //"ajax": 'api/Produk/GetAllProduk?name=' + $("#nama_item").val(),
                 "columns": [
                     { "data": "Title" },
                     { "data": "Deskripsi" },
                     { "data": "null" },
                     { "data": "null", "width": "3%", "class": "tengah" }
                 ],
                 "columnDefs": [
                     {
                         "render": function (data, type, row) {
                             var klasifikasi = row.Klasifikasi == 0 ? "SIPIL" : "NONSIPIL";
                             return klasifikasi;
                         },
                         "targets": 2,
                         "orderable": false
                     },
                     {
                         "render": function (data, type, row) {
                             return '<a href="#" idRks="' + row.Id + '" class="btn btn-xs btn-primary pilih" title="pilih">Pilih RKS</a> ';
                         },
                         "targets": 3,
                         "orderable": false
                     }
                 ],
                 "paging": true,
                 "lengthChange": false,
                 "ordering": true,
                 "info": true,
                 "autoWidth": false,
                 "responsive": true
             });

             $("#list-rks-template").on("click", ".pilih", function () {
                 var Id = $(this).attr("idRks");
                 waitingDialog.showloading("Proses Harap Tunggu");
                 $.ajax({
                     method: "POST",
                     url: "Api/PengadaanE/saveRksFromTemplate?RksId=" + Id + "&PengadaanId=" + $("#pengadaanId").val(),
                     dataType: "json",
                     contentType: 'application/json; charset=utf-8',
                     success: function (data) {
                         waitingDialog.hideloading();
                         window.location.reload();
                     }
                 });
             });

             $("#title-rks,#klasifikasi-rks").on("input propertychange paste", function () {
                 listTableRks.draw();
             });


             function init() {
                 var tables = document.getElementsByClassName("editabletable");
               
                 var i;
                 for (i = 0; i < tables.length; i++) {
                     var temp = tables[i].getElementsByTagName('tbody')[0];
                     
                     AddRow(temp, 100);
                     //makeTableEditable(temp);
                 }
             }

             function AddRow(table, rowCount) {
                
                 for (var s = 0; s < rowCount; s++) {
                     var row = table.insertRow(table.rows.length);
                     var cell = row.insertCell(0);
                     cell.innerHTML = "<div contenteditable></div>";
                     cell = row.insertCell(1);
                     cell.innerHTML = "<div contenteditable  ></div>";
                     cell = row.insertCell(2);
                     cell.innerHTML = "<div contenteditable  class='numberictest'></div>";
                     cell = row.insertCell(3);
                     cell.innerHTML = "<div contenteditable  class='numberictest'></div>";
                     cell = row.insertCell(4);
                     cell.innerHTML = "<div  class='numberictest'></div>";
                     cell = row.insertCell(5);
                     cell.innerHTML = "<div contenteditable></div>";
                     cell = row.insertCell(6);
                     cell.innerHTML = "";


                 }
                 
             }

             function makeTableEditable(table) {
                 var rows = table.rows;
                 var r;
                 for (r = 0; r < rows.length; r++) {
                     var cols = rows[r].cells;
                     var c;
                     for (c = 0; c < cols.length; c++) {
                         var cell = cols[c];
                         var listener = makeEditListener(table, r, c);
                         cell.addEventListener("input", listener, false);
                     }
                 }
             }

             function makeEditListener(table, row, col) {
                 return function (event) {
                     var cell = getCellElement(table, row, col);
                     var text = cell.innerHTML.replace(/<br>$/, '');
                     var items = split(text);
                     
                     if (items.length === 1) {
                         // Text is a single element, so do nothing.
                         // Without this each keypress resets the focus.
                        
                         return;
                     }

                     var i;
                     var r = row;
                     var c = col;
                     for (i = 0; i < items.length && r < table.rows.length; i++) {
                         cell = getCellElement(table, r, c);
                         cell.innerHTML = items[i]; // doesn't escape HTML

                         c++;
                         if (c === table.rows[r].cells.length) {
                             r++;
                             c = 0;
                         }
                     }
                     cell.focus();
                 };
             }

             function getCellElement(table, row, col) {
                 // assume each cell contains a div with the text
                 return table.rows[row].cells[col].firstChild;
             }

             function split(str) {
                 // use comma and whitespace as delimiters
                 //return str.split(/,|\s|<br>/);
                 return str.split(/\s|<br>/);
             }

             init();
             $(".numberictest").priceFormat({
                 prefix: '',
                 centsSeparator: ',',
                 thousandsSeparator: '.',
                 centsLimit: 2,
                 leadingZero: false
             });

             
             $(".numberictest").keyup(function () {
                 placeCaretAtEnd($(this).get(0));//set cursor to last of text
                 var satuan = $(this).closest('tr').find('.numberictest:eq(0)').priceToFloat();
                 var jumlah = $(this).closest('tr').find('.numberictest:eq(1)').priceToFloat();

                 var subtotal = satuan * jumlah;
                 $(this).closest('tr').find('td:eq(4)').html(subtotal.format(2,3,'.',','));

             });

             function placeCaretAtEnd(el) {
                 el.focus();
                 if (typeof window.getSelection != "undefined"
                     && typeof document.createRange != "undefined") {
                     var range = document.createRange();
                     range.selectNodeContents(el);
                     range.collapse(false);
                     var sel = window.getSelection();
                     sel.removeAllRanges();
                     sel.addRange(range);
                 } else if (typeof document.body.createTextRange != "undefined") {
                     var textRange = document.body.createTextRange();
                     textRange.moveToElementText(el);
                     textRange.collapse(false);
                     textRange.select();
                 }
             }
             function numberWithCommas(x) {
                 return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
             }
         });
     </script>
     <script>
         /**
         * Number.prototype.format(n, x, s, c)
         * 
         * @param integer n: length of decimal
         * @param integer x: length of whole part
         * @param mixed   s: sections delimiter
         * @param mixed   c: decimal delimiter
         */
         Number.prototype.format = function (n, x, s, c) {
             var re = '\\d(?=(\\d{' + (x || 3) + '})+' + (n > 0 ? '\\D' : '$') + ')',
                 num = this.toFixed(Math.max(0, ~~n));

             return (c ? num.replace('.', c) : num).replace(new RegExp(re, 'g'), '$&' + (s || ','));
         };
     </script>
  </body>
</html>
