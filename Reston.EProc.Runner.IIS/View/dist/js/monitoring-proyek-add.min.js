function hapusPersonil(n,t){$.ajax({method:"POST",url:"Api/Proyek/deletePIC?Id="+n}).done(function(n){n.status==200?t.parent().remove():alert("error")})}function TampilDokumenPekerjaan(){var n=$("#id_tahapModalPekerjaan").val();console.log(n);table_dokumen_pekerjaan=$("#list-dokumen-pekerjaan").DataTable({serverSide:!1,searching:!1,ajax:{url:"api/Proyek/TampilDokumenPekerjaan?Id="+n,type:"POST",data:function(n){Id=n.Id},error:function(){}},columns:[{data:"NamaDokumen"},{data:"null"},],columnDefs:[{render:function(n,t,i){return' <a tahapDokId="'+i.Id+'" class="btn btn-xs btn-danger remove-item" title="Hapus"><span class="fa fa-trash-o"><\/span><\/a>'},targets:1,orderable:!1},],pageLength:5,paging:!0,lengthChange:!1,ordering:!1,info:!0,autoWidth:!1,responsive:!0,destroy:!0})}function TampilDokumenPembayaran(){var n=$("#id_tahapModalPembayaran").val();table_dokumen_pembayaran=$("#list-dokumen-pembayaran").DataTable({serverSide:!0,searching:!1,ajax:{url:"api/Proyek/TampilDokumenPembayaran?Id="+n,type:"POST",data:function(n){Id=n.Id},error:function(){}},columns:[{data:"NamaDokumen"},{data:"null"},],columnDefs:[{render:function(n,t,i){return' <a tahapDokId="'+i.Id+'" class="btn btn-xs btn-danger remove-item" title="Hapus"><span class="fa fa-trash-o"><\/span><\/a>'},targets:1,orderable:!1},],paging:!0,lengthChange:!1,ordering:!0,info:!0,autoWidth:!1,responsive:!0,destroy:!0,iDisplayLength:3})}function showDeleteConfirmationPekerjaan(n){$("#tobeDeletePekerjaan").val(n);$("#DeleteModalPekerjaan").modal("show")}function showDeleteConfirmationPembayaran(n){$("#tobeDeletePembayaran").val(n);$("#DeleteModalPembayaran").modal("show")}function showDeleteConfirmationDokumenPekerjaan(n){$("#tobeDeleteDokumenPekerjaan").val(n);$("#DeleteModalDokumenPekerjaan").modal("show")}function showDeleteConfirmationDokumenPembayaran(n){$("#tobeDeleteDokumenPembayaran").val(n);$("#DeleteModalDokumenPembayaran").modal("show")}function DeletePekerjaan(n){$("#DeleteModalPekerjaan").modal("hide");var t=0;t=n?n:$("#tobeDeletePekerjaan").val();$.ajax({url:"/api/Proyek/delete?id="+t,success:function(){table_pekerjaan.draw()},complete:function(n){ajaxCompleteProcess(n)}})}function DeletePembayaran(n){$("#DeleteModalPembayaran").modal("hide");var t=0;t=n?n:$("#tobeDeletePembayaran").val();$.ajax({url:"/api/Proyek/delete?id="+t,success:function(){table_pembayaran.draw()},complete:function(n){ajaxCompleteProcess(n)}})}function DeleteDokumenPekerjaan(n){$("#DeleteModalDokumenPekerjaan").modal("hide");var t=0;t=n?n:$("#tobeDeleteDokumenPekerjaan").val();$.ajax({url:"/api/Proyek/deleteDok?id="+t,success:function(){table_dokumen_pekerjaan.draw()},complete:function(n){ajaxCompleteProcess(n)}})}function DeleteDokumenPembayaran(n){$("#DeleteModalDokumenPembayaran").modal("hide");var t=0;t=n?n:$("#tobeDeleteDokumenPembayaran").val();$.ajax({url:"/api/Proyek/deleteDok?id="+t,success:function(){table_dokumen_pembayaran.draw()},complete:function(n){ajaxCompleteProcess(n)}})}function TambahTahapanPekerjaan(){var n=$("#pengadaanId").val(),t=$("#nama-tahapan-pekerjaan").val(),i=moment($("#tanggal-pekerjaan-mulai").val(),["D MMMM YYYY HH:mm"],"id").format("DD/MM/YYYY HH:mm"),r=moment($("#tanggal-pekerjaan-selesai").val(),["D MMMM YYYY HH:mm"],"id").format("DD/MM/YYYY HH:mm"),u=$("#bobot-pekerjaan").val();$.ajax({method:"post",url:"api/Proyek/SimpanTahapanPekerjaan",datatype:"json",data:{aPengdaanId:n,aNamaTahapanPekerjaan:t,aTanggalMulai:i,aTanggalSelesai:r,aBobotPekerjaan:u,aJenisTahapan:"Pekerjaan"},success:function(n){$("#tahapanup").modal("hide");$("#nama-tahapan-pekerjaan").val("");$("#tanggal-pekerjaan-mulai").val("");$("#tanggal-pekerjaan-selesai").val("");$("#bobot-pekerjaan").val("");n.message==null?(BootstrapDialog.show({title:"Konfirmasi",message:"Data Berhasil di Simpan",buttons:[{label:"Close",action:function(n){n.close()}}]}),table_pekerjaan.draw()):BootstrapDialog.show({title:"ERROR",message:n.message,buttons:[{label:"Close",action:function(n){n.close()}}]})}})}function TambahTahapanPembayaran(){var n=$("#pengadaanId").val(),t=$("#nama-tahapan-pembayaran").val(),i=moment($("#tanggal-pembayaran-mulai").val(),["D MMMM YYYY HH:mm"],"id").format("DD/MM/YYYY HH:mm"),r=moment($("#tanggal-pembayaran-selesai").val(),["D MMMM YYYY HH:mm"],"id").format("DD/MM/YYYY HH:mm");$.ajax({method:"post",url:"api/Proyek/SimpanTahapanPekerjaan",datatype:"json",data:{aPengdaanId:n,aNamaTahapanPekerjaan:t,aTanggalMulai:i,aTanggalSelesai:r,aJenisTahapan:"Pembayaran",aBobotPekerjaan:0},success:function(){$("#tahapanuppem").modal("hide");$("#nama-tahapan-pembayaran").val("");$("#tanggal-pembayaran-mulai").val("");$("#tanggal-pembayaran-selesai").val("");BootstrapDialog.show({title:"Konfirmasi",message:"Data Berhasil di Simpan",buttons:[{label:"Close",action:function(n){n.close()}}]});table_pembayaran.draw()}})}function TambahProyekDrafPekerjaan(){var n=$("#pengadaanId").val(),t=moment($("#pendaftaran").val(),["D MMMM YYYY HH:mm"],"id").format("DD/MM/YYYY HH:mm"),i=moment($("#pendaftaran_sampai").val(),["D MMMM YYYY HH:mm"],"id").format("DD/MM/YYYY HH:mm"),r=$("#status").val();$.ajax({method:"post",url:"api/Proyek/SimpanRencanaProyek",datatype:"json",data:{aPengadaanId:n,aStartDate:t,aEndDate:i,aStatus:r},success:function(){popuptahapan()}})}function SimpanProyek(){var n=$("#pengadaanId").val(),t=$("#no-spk").val();$.ajax({method:"post",url:"api/Proyek/UbahStatusRencanaProyek",datatype:"json",data:{Id:n,NoKontrak:t,Status:"dijalankan"},success:function(){BootstrapDialog.show({title:"Konfirmasi",message:"Data Berhasil di Simpan",buttons:[{label:"Close",action:function(n){n.close()}}]})}})}function TambahTahapanDokumen(){var i=$("#tahapanpekerjaanId").val(),n=$("#nama-dokumen").val(),t=moment($("#tanggal-tahapan-pekerjaan").val(),["D MMMM YYYY HH:mm"],"id").format("DD/MM/YYYY HH:mm");$.ajax({method:"post",url:"api/Proyek/SimpanTahapanDokumen",datatype:"json",data:{aPengdaanId:nPengadaanId,aNamaDokumen:n,aTanggalPekerjaan:t,aJenisTahapan:"Pekerjaan"},success:function(){$("#tahapanup").modal("hide");$("#tahapanuppem").modal("hide");$("#nama-tahapan-pekerjaan").val("");$("#tanggal-tahapan-pekerjaan").val("");BootstrapDialog.show({title:"Konfirmasi",message:"Data Berhasil di Simpan",buttons:[{label:"Close",action:function(n){n.close()}}]});table_dokumen_pekerjaan.draw()}})}function TambahProyekDrafPembayaran(){var n=$("#pengadaanId").val(),t=moment($("#pendaftaran").val(),["D MMMM YYYY HH:mm"],"id").format("DD/MM/YYYY HH:mm"),i=moment($("#pendaftaran_sampai").val(),["D MMMM YYYY HH:mm"],"id").format("DD/MM/YYYY HH:mm"),r=$("#status").val();$.ajax({method:"post",url:"api/Proyek/SimpanRencanaProyek",datatype:"json",data:{aPengadaanId:n,aStartDate:t,aEndDate:i,aStatus:r},success:function(){popuptahapanpembayaran()}})}function popuptahapan(){$("#tahapanup").modal("show")}function popuptahapanpembayaran(){$("#tahapanuppem").modal("show")}function TampilModalDokumen(n){$("#id_tahapModalPekerjaan").val(n);$("#dokumenupPekerjaan").modal("show");TampilDokumenPekerjaan()}function TampilModalDokumenPembayaran(n){$("#id_tahapModalPembayaran").val(n);$("#dokumenupPembayaran").modal("show");TampilDokumenPembayaran()}function TambahDokumenPekerjaan(){var id_tahapan=0;Id_Tahapan=$("#id_tahapModalPekerjaan").val();Jenis_Dokumen=$("#jenis-tahapanModalPekerjaan").val();Nama_Dokumen=$("#nama-dokumen").val();$.ajax({method:"post",url:"api/Proyek/SimpanTahapanPekerjaanDokumen",datatype:"json",data:{aId_Tahapan:Id_Tahapan,aJenis_Tahapan:Jenis_Dokumen,aNama_Dokumen:Nama_Dokumen},success:function(){$("#list-dokumen-pekerjaan").modal("hide");Nama_Dokumen=$("#nama-dokumen").val("");BootstrapDialog.show({title:"Konfirmasi",message:"Data Berhasil di Simpan",buttons:[{label:"Close",action:function(n){n.close()}}]});table_dokumen_pekerjaan.draw()}})}function TambahDokumenPembayaran(){var id_tahapan=0;Id_Tahapan=$("#id_tahapModalPembayaran").val();Jenis_Dokumen=$("#jenis-tahapanModalPembayaran").val();Nama_Dokumen=$("#nama-dokumen-pembayaran").val();$.ajax({method:"post",url:"api/Proyek/SimpanTahapanPembayaranDokumen",datatype:"json",data:{aId_Tahapan:Id_Tahapan,aJenis_Tahapan:Jenis_Dokumen,aNama_Dokumen:Nama_Dokumen},success:function(){$("#list-dokumen-pembayaran").modal("hide");Nama_Dokumen=$("#nama-dokumen").val("");BootstrapDialog.show({title:"Konfirmasi",message:"Data Berhasil di Simpan",buttons:[{label:"Close",action:function(n){n.close()}}]});table_dokumen_pembayaran.draw()}})}function numberWithCommas(n){var t=n.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function loadData(){$.ajax({method:"POST",url:"Api/PengadaanE/detailPengadaan?Id="+id_rks}).done(function(n){loadHeaderPengadaan(n)})}function gup(n,t){t||(t=location.href);n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r="[\\?&]"+n+"=([^&#]*)",u=new RegExp(r),i=u.exec(t);return i==null?null:i[1]}function getListPersonil(){return arrPersonilPengadaan=[],$(".list-personil").each(function(){objPersonilPengadaan={};objPersonilPengadaan.PersonilId=$(this).val();objPersonilPengadaan.tipe=$(this).attr("attr1");objPersonilPengadaan.Nama=$(this).attr("attr2");objPersonilPengadaan.Jabatan=$(this).attr("attr3");arrPersonilPengadaan.push(objPersonilPengadaan)}),arrPersonilPengadaan}function LoadListPersonil(n){var t=gup("id-pengadaan");$("#pengadaanId").val(t);addLoadPersonil(n,".listperson-pic",0)}function addPersonil(n,t){var r=t.replace(".listperson-",""),i={};if(i.UserId=n.PersonilId,i.tipe=r,i.Nama=n.Nama,i.Jabatan=n.Jabatan,i.PengadaanId=$("#pengadaanId").val(),r=="pic"&&$(t).children().length>0)return BootstrapDialog.show({title:"Konfirmasi",message:"PIC Sudah Ada!",buttons:[{label:"Close",action:function(n){n.close()}}]}),!1;if(isPersonileEksisPerPeran(n.PersonilId,t)==1)return BootstrapDialog.show({title:"Konfirmasi",message:"User yang Ingin ditambahkan Sudah Ada!",buttons:[{label:"Close",action:function(n){n.close()}}]}),!1;$.ajax({method:"POST",url:"Api/Proyek/savePersonil",dataType:"json",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(i){i.status==200?(html='<a class="btn btn-app"><input type="hidden" class="list-personil" attrId="'+i.Id+'" attr1="'+r+'" attr2="'+n.Nama+'" attr3="'+n.Jabatan+'" value="'+n.PersonilId+'" /><span class="badge bg-red remove-person"><i class="fa fa-remove"><\/i><\/span><i class="fa fa-user"><\/i>'+n.Nama+"<\/a>",$(t).append(html),$("#personilModal").modal("hide")):alert("error")})}function isPersonileEksis(n){var t=0;return $(".list-personil").each(function(i,r){if($.trim($(r).val())==$.trim(n))return t=1,!1}),t}function isPersonileEksisPerPeran(n,t){var i=0;return $(t).find(".list-personil").each(function(t,r){if($.trim($(r).val())==$.trim(n))return i=1,!1}),i}function addLoadPersonil(n,t){var i=t.replace(".listperson-","");html='<a class="btn btn-app"><input type="hidden" class="list-personil" attrId="'+n[0].Id+'" attr1="'+n[0].Id+'" attr2="'+n[0].NamaPIC+'" value="'+n[0].Id+'" /><span class="badge bg-red remove-person"><i class="fa fa-remove"><\/i><\/span><i class="fa fa-user"><\/i>'+n[0].NamaPIC+"<\/a>";$(t).append(html)}function addItem(n){var t=table.data().length,i=1,r;t>0&&(r=table.row(t-1).data(),i=parseInt(r[0])+1);table.row.add([i,n[1],n[2],'<a class="btn btn-xs btn-danger remove-item" title="Hapus"><span class="fa fa-trash-o"><\/span><\/a>']).draw()}function hitungHargaItem(){var n=0,t;table.rows().every(function(){var i=this.data(),t=i[2];i.counter++;t=parseInt(UnformatFloat(t));this.invalidate();n=n+t});t=accounting.formatNumber(n,{thousand:"."});$("#estimated_cost").val(t)}var table,table_pekerjaan,table_pembayaran,table_dokumen_pekerjaan,table_dokumen_pembayaran;$(function(){var n=gup("id-pengadaan");$("#pengadaanId").val(n);table_pekerjaan=$("#tahapan-pekerjaan").DataTable({serverSide:!0,searching:!1,ajax:{url:"api/Proyek/TampilTahapanPekerjaan?Id="+n,type:"POST",data:function(n){Id=n.Id},error:function(){}},columns:[{data:"NamaTahapan"},{data:"TanggalMulai"},{data:"TanggalSelesai"},{data:"null"},],columnDefs:[{render:function(n,t,i){return moment(i.TanggalMulai).format("DD MMMM YYYY")},targets:1,orderable:!1},{render:function(n,t,i){return moment(i.TanggalSelesai).format("DD MMMM YYYY")},targets:2,orderable:!1},{render:function(n,t,i){return' <a  tahapId="'+i.Id+'"  class="btn btn-xs btn-info tambah-dokumen-pekerjaan" title="Dokumen Pekerjaan"><span class="fa fa-cloud-upload"><\/span> Dokumen <\/a>  <a tahapId="'+i.Id+'" class="btn btn-xs btn-danger remove-item" title="Hapus"><span class="fa fa-trash-o"><\/span><\/a>'},targets:3,orderable:!1},],paging:!0,lengthChange:!1,ordering:!0,info:!0,autoWidth:!1,responsive:!0});$("body").on("click",".remove-person",function(){hapusPersonil($(this).parent().find("input").attr("attrid"),$(this))})});$(function(){var n=gup("id-pengadaan");$("#pengadaanId").val(n);table_pembayaran=$("#tahapan-pembayaran").DataTable({serverSide:!0,searching:!1,ajax:{url:"api/Proyek/TampilTahapanPembayaran?Id="+n,type:"POST",data:function(n){Id=n.Id},error:function(){}},columns:[{data:"NamaTahapan"},{data:"TanggalMulai"},{data:"TanggalSelesai"},{data:"null"},],columnDefs:[{render:function(n,t,i){return moment(i.TanggalMulai).format("DD MMMM YYYY")},targets:1,orderable:!1},{render:function(n,t,i){return moment(i.TanggalSelesai).format("DD MMMM YYYY")},targets:2,orderable:!1},{render:function(n,t,i){return' <a  tahapId="'+i.Id+'"  class="btn btn-xs btn-info tambah-dokumen-pembayaran" title="Dokumen Pembayaran"><span class="fa fa-cloud-upload"><\/span> Dokumen <\/a> <a tahapId="'+i.Id+'" class="btn btn-xs btn-danger remove-item" title="Hapus"><span class="fa fa-trash-o"><\/span><\/a>'},targets:3,orderable:!1},],paging:!0,lengthChange:!1,ordering:!0,info:!0,autoWidth:!1,responsive:!0})});$("#tahapan-pekerjaan").on("click",".remove-item",function(){showDeleteConfirmationPekerjaan($(this).attr("tahapId"))});$("#tahapan-pembayaran").on("click",".remove-item",function(){showDeleteConfirmationPembayaran($(this).attr("tahapId"))});$("#list-dokumen-pekerjaan").on("click",".remove-item",function(){showDeleteConfirmationDokumenPekerjaan($(this).attr("tahapDokId"))});$("#list-dokumen-pembayaran").on("click",".remove-item",function(){showDeleteConfirmationDokumenPembayaran($(this).attr("tahapDokId"))});$("#SimpanJalankan").on("click",function(){SimpanProyek()});$(document).on("show.bs.modal",".modal",function(){var n=1040+10*$(".modal:visible").length;$(this).css("z-index",n);setTimeout(function(){$(".modal-backdrop").not(".modal-stack").css("z-index",n-1).addClass("modal-stack")},0)});$(function(){var n=gup("id-pengadaan");$("#pengadaanId").val(n);$.ajax({method:"post",url:"api/Proyek/TampilJudul?Id="+n,success:function(n){$("#judul").val(n.Judul);$("#no-pengadaan").val(n.NoPengadaan);$("#pelaksana").val(n.Pelaksana);$("#no-spk").val(n.NOSPK);$("#nilai-kontrak").val(numberWithCommas(n.NilaiKontrak));n.TanggalMulai!=null&&$("#pendaftaran").val(moment(n.TanggalMulai).format("DD MMMM YYYY"));n.TanggalSelesai!=null&&$("#pendaftaran_sampai").val(moment(n.TanggalSelesai).format("DD MMMM YYYY"));LoadListPersonil(n.PIC)}})});$(".addPerson").on("click",function(){$("#title-modal").html("Daftar Personil");$("#tipe-person-list").val($(this).attr("attr1"));$("#personilModal").modal("show");$(".item-bg-blue-light").each(function(){$(this).removeClass("item-bg-blue-light")})});$(".dateJadwal").datetimepicker({format:"DD MMMM YYYY HH:mm",locale:"id",useCurrent:!1,minDate:Date.now()}).on("dp.change",function(n){var o=$(this).attr("name"),t=$(this).attr("nextJadwal"),r=$(this).attr("beforeJadwal"),f=moment($(this).val(),["D MMMM YYYY HH:mm"],"id"),u,e,i;t!=""&&(u=moment($(t).val(),["D MMMM YYYY HH:mm"],"id"),$(t).data("DateTimePicker").minDate(n.date),$(t).removeAttr("disabled"),u=moment($(t).val(),["D MMMM YYYY HH:mm"],"id"),i=f.diff(u),$(t).val()!=""&&i>=0&&(BootstrapDialog.show({title:"Konfirmasi",message:"Jadwal Tidak Boleh Lebih Besar dari Jadwal Berikutnya!",buttons:[{label:"Close",action:function(n){n.close()}}]}),$(this).val("")));r!=""&&(e=moment($(r).val(),["D MMMM YYYY HH:mm"],"id"),i=f.diff(e),i<=0&&(BootstrapDialog.show({title:"Konfirmasi",message:"Jadwal Tidak Boleh Lebih Kecil!",buttons:[{label:"Close",action:function(n){n.close()}}]}),$(this).val("")),$(r).val()==""&&(BootstrapDialog.show({title:"Konfirmasi",message:"Isi Jadwal Sesuai Urutan!",buttons:[{label:"Close",action:function(n){n.close()}}]}),$(this).val("")))});app.controller("PersonCtrl",["$scope","$http",function(n,t){n.persons=[];t.get("api/pengadaane/getUsers?start=0&limit=5&name=").then(function(t){n.persons=t.data.Users});n.getPerson=function(n,t){$(n.currentTarget).hasClass("item-bg-blue-light")?$(n.currentTarget).removeClass("item-bg-blue-light"):($(n.currentTarget).addClass("item-bg-blue-light"),addPersonil(t,$("#tipe-person-list").val()))};n.searchPerson=function(){t.get("api/pengadaane/getUsers?start=0&limit=5&name="+$("#search").val()).then(function(t){n.persons=t.data.Users;jum>=t.data.totalRecord?$("#pop-personil-next").html(""):$("#pop-personil-next").html("Berikutnya")})};n.nextPerson=function(){var i=$(".pop-personil-list").find("li").length;t.get("api/pengadaane/getUsers?start="+i+"&limit=5&name="+$("#search").val()).then(function(t){$.each(t.data.Users,function(t,r){n.persons.push(r);i=i+1});i>=t.data.totalRecord&&$("#pop-personil-next").html("")})};$("#tahapan-pekerjaan").on("click",".tambah-dokumen-pekerjaan",function(){TampilModalDokumen($(this).attr("tahapId"))});$("#tahapan-pembayaran").on("click",".tambah-dokumen-pembayaran",function(){TampilModalDokumenPembayaran($(this).attr("tahapId"))})}]);